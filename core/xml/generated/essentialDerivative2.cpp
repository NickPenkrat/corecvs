#include <vector>
#include "correspondenceList.h"
#include "essentialEstimator.h"

using namespace std;
namespace corecvs {

Matrix derivative(const double in[], const vector<Correspondence *> *samples) {
    Matrix result(samples->size(), EssentialEstimator::CostFunctionBase::VECTOR_SIZE);
    double Qx = in[EssentialEstimator::CostFunctionBase::ROTATION_Q_X]; 
    double Qy = in[EssentialEstimator::CostFunctionBase::ROTATION_Q_Y]; 
    double Qz = in[EssentialEstimator::CostFunctionBase::ROTATION_Q_Z]; 
    double Qt = in[EssentialEstimator::CostFunctionBase::ROTATION_Q_T]; 
    double Tx = in[EssentialEstimator::CostFunctionBase::TRANSLATION_X]; 
    double Ty = in[EssentialEstimator::CostFunctionBase::TRANSLATION_Y]; 
    double Tz = in[EssentialEstimator::CostFunctionBase::TRANSLATION_Z]; 
   double m[9];
   double md[7 * 9];
    m[0] = (0-Tz)*(Qx*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Ty*(Qx*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));

     md[0]= (0-Tz)*((Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Ty*((Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))-Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[1]= (0-Tz)*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Ty*(Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[2]= (0-Tz)*(Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Ty*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[3]= (0-Tz)*(Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Ty*(Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[4]= 0;
     md[5]= Qx*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)));
     md[6]= (-1)*(Qx*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));

    m[1] = (0-Tz)*(1-(Qx*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qz*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Ty*(Qy*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));

     md[7]= (0-Tz)*(0-((Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Ty*(Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[8]= (0-Tz)*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Ty*((Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[9]= (0-Tz)*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))))+Ty*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[10]= (0-Tz)*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Ty*(Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[11]= 0;
     md[12]= Qy*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)));
     md[13]= (-1)*(1-(Qx*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qz*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));

    m[2] = (0-Tz)*(Qy*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Ty*(1-(Qx*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qy*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));

     md[14]= (0-Tz)*(Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Ty*(0-((Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[15]= (0-Tz)*((Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))-Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Ty*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))));
     md[16]= (0-Tz)*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Ty*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[17]= (0-Tz)*(Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Ty*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[18]= 0;
     md[19]= 1-(Qx*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qy*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));
     md[20]= (-1)*(Qy*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));

    m[3] = Tz*(1-(Qy*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qz*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+(0-Tx)*(Qx*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));

     md[21]= Tz*(0-(Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+(0-Tx)*((Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))-Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[22]= Tz*(0-((Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+(0-Tx)*(Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[23]= Tz*(0-(Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))))+(0-Tx)*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[24]= Tz*(0-(Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+(0-Tx)*(Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[25]= (-1)*(Qx*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));
     md[26]= 0;
     md[27]= 1-(Qy*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qz*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));

    m[4] = Tz*(Qx*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(0-Tx)*(Qy*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));

     md[28]= Tz*((Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))-Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+(0-Tx)*(Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[29]= Tz*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+(0-Tx)*((Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[30]= Tz*(Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+(0-Tx)*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[31]= Tz*(Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+(0-Tx)*(Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[32]= (-1)*(Qy*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));
     md[33]= 0;
     md[34]= Qx*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)));

    m[5] = Tz*(Qx*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(0-Tx)*(1-(Qx*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qy*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));

     md[35]= Tz*((Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+(0-Tx)*(0-((Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[36]= Tz*(Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+(0-Tx)*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))));
     md[37]= Tz*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+(0-Tx)*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[38]= Tz*(Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+(0-Tx)*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[39]= (-1)*(1-(Qx*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qy*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[40]= 0;
     md[41]= Qx*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)));

    m[6] = (0-Ty)*(1-(Qy*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qz*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Tx*(Qx*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));

     md[42]= (0-Ty)*(0-(Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Tx*((Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[43]= (0-Ty)*(0-((Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Tx*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[44]= (0-Ty)*(0-(Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))))+Tx*(Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[45]= (0-Ty)*(0-(Qy*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Tx*(Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[46]= Qx*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)));
     md[47]= (-1)*(1-(Qy*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qz*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[48]= 0;

    m[7] = (0-Ty)*(Qx*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Tx*(1-(Qx*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qz*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));

     md[49]= (0-Ty)*((Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))-Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Tx*(0-((Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[50]= (0-Ty)*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Tx*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[51]= (0-Ty)*(Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Tx*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))));
     md[52]= (0-Ty)*(Qx*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Tx*(0-(Qx*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qz*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[53]= 1-(Qx*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qz*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));
     md[54]= (-1)*(Qx*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));
     md[55]= 0;

    m[8] = (0-Ty)*(Qx*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Tx*(Qy*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));

     md[56]= (0-Ty)*((Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Tx*(Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qx+Qx))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[57]= (0-Ty)*(Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Tx*((Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))-Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qy+Qy))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[58]= (0-Ty)*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))))+Tx*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)+Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qz+Qz))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))));
     md[59]= (0-Ty)*(Qx*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))+(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qy*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))))+Tx*(Qy*(Qz*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))-(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))+Qt*(Qx*((0-2*(0.5*((1.0 / sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))*(Qt+Qt))))/(sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)*sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))))));
     md[60]= Qy*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))-Qt*(Qx*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)));
     md[61]= (-1)*(Qx*(Qz*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt)))+Qt*(Qy*(2/sqrt(((Qx*Qx+Qy*Qy)+Qz*Qz)+Qt*Qt))));
     md[62]= 0;


   for (size_t i = 0; i < samples->size(); i++)
   {
        double startx = (*samples)[i]->start.x();
        double starty = (*samples)[i]->start.y();
        double endx   = (*samples)[i]->end.x();
        double endy   = (*samples)[i]->end.y();
   
         double v = ((((startx*a00+starty*a10)+a20)*endx+((startx*a01+starty*a11)+a21)*endy)+((startx*a02+starty*a12)+a22))/sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21));
         result.element(i,0) = (((((startx*md[0]+starty*md[21])+md[42])*endx+((startx*md[7]+starty*md[28])+md[49])*endy)+((startx*md[14]+starty*md[35])+md[56]))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))-((((startx*a00+starty*a10)+a20)*endx+((startx*a01+starty*a11)+a21)*endy)+((startx*a02+starty*a12)+a22))*(0.5*((1.0 / sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)))*((((startx*md[0]+starty*md[21])+md[42])*((startx*a00+starty*a10)+a20)+((startx*a00+starty*a10)+a20)*((startx*md[0]+starty*md[21])+md[42]))+(((startx*md[7]+starty*md[28])+md[49])*((startx*a01+starty*a11)+a21)+((startx*a01+starty*a11)+a21)*((startx*md[7]+starty*md[28])+md[49]))))))/(sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)));
         if (v < 0) result.element(i,0) = -result.element(i,0);
         result.element(i,1) = (((((startx*md[1]+starty*md[22])+md[43])*endx+((startx*md[8]+starty*md[29])+md[50])*endy)+((startx*md[15]+starty*md[36])+md[57]))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))-((((startx*a00+starty*a10)+a20)*endx+((startx*a01+starty*a11)+a21)*endy)+((startx*a02+starty*a12)+a22))*(0.5*((1.0 / sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)))*((((startx*md[1]+starty*md[22])+md[43])*((startx*a00+starty*a10)+a20)+((startx*a00+starty*a10)+a20)*((startx*md[1]+starty*md[22])+md[43]))+(((startx*md[8]+starty*md[29])+md[50])*((startx*a01+starty*a11)+a21)+((startx*a01+starty*a11)+a21)*((startx*md[8]+starty*md[29])+md[50]))))))/(sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)));
         if (v < 0) result.element(i,1) = -result.element(i,1);
         result.element(i,2) = (((((startx*md[2]+starty*md[23])+md[44])*endx+((startx*md[9]+starty*md[30])+md[51])*endy)+((startx*md[16]+starty*md[37])+md[58]))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))-((((startx*a00+starty*a10)+a20)*endx+((startx*a01+starty*a11)+a21)*endy)+((startx*a02+starty*a12)+a22))*(0.5*((1.0 / sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)))*((((startx*md[2]+starty*md[23])+md[44])*((startx*a00+starty*a10)+a20)+((startx*a00+starty*a10)+a20)*((startx*md[2]+starty*md[23])+md[44]))+(((startx*md[9]+starty*md[30])+md[51])*((startx*a01+starty*a11)+a21)+((startx*a01+starty*a11)+a21)*((startx*md[9]+starty*md[30])+md[51]))))))/(sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)));
         if (v < 0) result.element(i,2) = -result.element(i,2);
         result.element(i,3) = (((((startx*md[3]+starty*md[24])+md[45])*endx+((startx*md[10]+starty*md[31])+md[52])*endy)+((startx*md[17]+starty*md[38])+md[59]))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))-((((startx*a00+starty*a10)+a20)*endx+((startx*a01+starty*a11)+a21)*endy)+((startx*a02+starty*a12)+a22))*(0.5*((1.0 / sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)))*((((startx*md[3]+starty*md[24])+md[45])*((startx*a00+starty*a10)+a20)+((startx*a00+starty*a10)+a20)*((startx*md[3]+starty*md[24])+md[45]))+(((startx*md[10]+starty*md[31])+md[52])*((startx*a01+starty*a11)+a21)+((startx*a01+starty*a11)+a21)*((startx*md[10]+starty*md[31])+md[52]))))))/(sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)));
         if (v < 0) result.element(i,3) = -result.element(i,3);
         result.element(i,4) = (((((startx*md[4]+starty*md[25])+md[46])*endx+((startx*md[11]+starty*md[32])+md[53])*endy)+((startx*md[18]+starty*md[39])+md[60]))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))-((((startx*a00+starty*a10)+a20)*endx+((startx*a01+starty*a11)+a21)*endy)+((startx*a02+starty*a12)+a22))*(0.5*((1.0 / sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)))*((((startx*md[4]+starty*md[25])+md[46])*((startx*a00+starty*a10)+a20)+((startx*a00+starty*a10)+a20)*((startx*md[4]+starty*md[25])+md[46]))+(((startx*md[11]+starty*md[32])+md[53])*((startx*a01+starty*a11)+a21)+((startx*a01+starty*a11)+a21)*((startx*md[11]+starty*md[32])+md[53]))))))/(sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)));
         if (v < 0) result.element(i,4) = -result.element(i,4);
         result.element(i,5) = (((((startx*md[5]+starty*md[26])+md[47])*endx+((startx*md[12]+starty*md[33])+md[54])*endy)+((startx*md[19]+starty*md[40])+md[61]))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))-((((startx*a00+starty*a10)+a20)*endx+((startx*a01+starty*a11)+a21)*endy)+((startx*a02+starty*a12)+a22))*(0.5*((1.0 / sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)))*((((startx*md[5]+starty*md[26])+md[47])*((startx*a00+starty*a10)+a20)+((startx*a00+starty*a10)+a20)*((startx*md[5]+starty*md[26])+md[47]))+(((startx*md[12]+starty*md[33])+md[54])*((startx*a01+starty*a11)+a21)+((startx*a01+starty*a11)+a21)*((startx*md[12]+starty*md[33])+md[54]))))))/(sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)));
         if (v < 0) result.element(i,5) = -result.element(i,5);
         result.element(i,6) = (((((startx*md[6]+starty*md[27])+md[48])*endx+((startx*md[13]+starty*md[34])+md[55])*endy)+((startx*md[20]+starty*md[41])+md[62]))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))-((((startx*a00+starty*a10)+a20)*endx+((startx*a01+starty*a11)+a21)*endy)+((startx*a02+starty*a12)+a22))*(0.5*((1.0 / sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)))*((((startx*md[6]+starty*md[27])+md[48])*((startx*a00+starty*a10)+a20)+((startx*a00+starty*a10)+a20)*((startx*md[6]+starty*md[27])+md[48]))+(((startx*md[13]+starty*md[34])+md[55])*((startx*a01+starty*a11)+a21)+((startx*a01+starty*a11)+a21)*((startx*md[13]+starty*md[34])+md[55]))))))/(sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21))*sqrt(((startx*a00+starty*a10)+a20)*((startx*a00+starty*a10)+a20)+((startx*a01+starty*a11)+a21)*((startx*a01+starty*a11)+a21)));
         if (v < 0) result.element(i,6) = -result.element(i,6);
   return result;
}
} // namespace
